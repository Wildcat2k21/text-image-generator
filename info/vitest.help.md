# Руководство по Vitest для браузерной разработки на чистом JavaScript

Это руководство поможет тебе настроить и использовать **Vitest** для тестирования проектов, где используется чистый JavaScript для браузера. Мы рассмотрим установку, конфигурацию, написание тестов для DOM и ESM модулей, запуск и лучшие практики.

---

## 1. Введение

**Vitest** — современный тест-раннер, разработанный для экосистемы Vite, который поддерживает ES-модули и позволяет легко тестировать как DOM, так и обычные функции. Он отлично подходит для проектов, где не используется React или другие фреймворки, а нужен быстрый и простой способ проведения модульных тестов.

---

## 2. Установка и настройка

### Шаг 1. Инициализация проекта

Если у тебя ещё нет `package.json`, создай его:
```bash
npm init -y
```

### Шаг 2. Установка зависимостей

Установи **Vite**, **Vitest** и **jsdom** (для тестирования DOM):
```bash
npm install -D vite vitest jsdom
```

### Шаг 3. Конфигурация Vite

Создай файл `vite.config.js` в корне проекта:
```js
import { defineConfig } from 'vite';

export default defineConfig({
  test: {
    // Указываем среду выполнения тестов
    environment: 'jsdom',
    // Дополнительные настройки, например, globals
    globals: true,
  },
});
```

---

## 3. Структура проекта

Рекомендуемая структура:
```
project/
├── index.html
├── src/
│   ├── dom.js        // Функции для работы с DOM
│   └── math.js       // Пример обычного модуля (ESM)
├── tests/
│   ├── dom.test.js   // Тесты для DOM-элементов
│   └── math.test.js  // Тесты для обычных функций
├── vite.config.js
└── package.json
```

---

## 4. Написание тестов

### 4.1 Тестирование DOM-элементов

**Файл:** `src/dom.js`
```js
export function createButton(text) {
  const btn = document.createElement('button');
  btn.textContent = text;
  return btn;
}
```

**Тест:** `tests/dom.test.js`
```js
import { describe, it, expect } from 'vitest';
import { createButton } from '../src/dom';

describe('createButton', () => {
  it('должен создавать HTMLButtonElement с заданным текстом', () => {
    const btn = createButton('Нажми меня');
    expect(btn).toBeInstanceOf(HTMLButtonElement);
    expect(btn.textContent).toBe('Нажми меня');
  });
});
```

---

### 4.2 Тестирование ESM модулей и обычных функций

**Файл:** `src/math.js`
```js
// Пример простой функции для сложения двух чисел
export function sum(a, b) {
  return a + b;
}

// Пример функции для проверки чётности числа
export function isEven(num) {
  return num % 2 === 0;
}
```

**Тест:** `tests/math.test.js`
```js
import { describe, it, expect } from 'vitest';
import { sum, isEven } from '../src/math';

describe('Модуль math.js', () => {
  it('функция sum должна корректно складывать числа', () => {
    expect(sum(1, 2)).toBe(3);
    expect(sum(-1, 1)).toBe(0);
  });

  it('функция isEven должна правильно определять чётные числа', () => {
    expect(isEven(4)).toBe(true);
    expect(isEven(5)).toBe(false);
  });
});
```

---

## 5. Запуск тестов

Запусти тесты с помощью команды:
```bash
npx vitest
```

Для режима наблюдения (watch mode):
```bash
npx vitest --watch
```

При запуске Vitest использует конфигурацию из `vite.config.js` и, в случае тестирования DOM, эмулирует браузерное окружение через jsdom.

---

## 6. Дополнительные возможности и советы

### Использование глобальных настроек

В конфигурации можно задать глобальные переменные, чтобы не импортировать функции тестирования в каждом файле:
```js
test: {
  globals: true,
}
```

### Организация тестов

- **Группировка тестов:** Используй `describe` для объединения связанных тестов.
- **Понятные имена тестов:** Пиши тесты так, чтобы было ясно, какую функциональность они проверяют.
- **Изоляция окружения:** Для тестов, работающих с DOM, убедись, что каждый тест начинается с чистого состояния.

### Использование моков и шпионов

Vitest поддерживает мокинг и создание шпионов, что позволяет изолировать тестируемые функции. Подробности смотри в [официальной документации Vitest](https://vitest.dev/).

### Интеграция с CI/CD

Добавь запуск тестов в процесс CI/CD для автоматической проверки качества кода. Например, можно добавить скрипт в `package.json`:
```json
"scripts": {
  "test": "vitest"
}
```

---

## 7. Лучшие практики

- **Пиши небольшие, сфокусированные тесты:** Каждый тест должен проверять одну конкретную функциональность.
- **Избегай зависимости от глобального состояния:** Воспроизводи необходимое окружение в каждом тесте.
- **Тестируй критические участки кода:** Особенно функции, которые работают с логикой (например, математические операции, манипуляции с данными).
- **Обновляй зависимости:** Следи за обновлениями Vitest и Vite для использования последних улучшений и исправлений.
- **Пиши документацию и комментарии:** Комментарии помогают другим разработчикам понимать логику тестов.

---

## 8. Заключение
**Vitest** — мощный и быстрый инструмент для модульного тестирования браузерных приложений на чистом JavaScript. С его помощью можно легко тестировать как DOM-элементы, так и обычные функции, реализованные в ESM модулях.
[официальной документации Vitest](https://vitest.dev/) для получения дополнительной информации.
